---
import { ViewTransitions } from "astro:transitions";
import "../styles/global.css";
const { title, description } = Astro.props;

const SEOdescription = description
  ? description
  : "Innovative Creative Studio Specializing in Video Production. We push the boundaries of conventional taste to deliver powerful, impactful visuals.";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={SEOdescription} />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <meta property="og:image" content="https://i.imgur.com/Ym1QvNA.png" />
    <title>{title}</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />
    <meta name="msapplication-TileColor" content="#ffc40d" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="icon" type="image/svg+xml" href="/woe-favicon.svg" />
    <meta name="theme-color" content="#000000" />
    <ViewTransitions />
  </head>
  <body>
    <div id="transition-overlay" class="transition-overlay"></div>
    <main>
      <slot name="nav" />
      <slot />
      <div class="cursor-follower" id="cursor-follower">
        <div class="cursor-inner">
          <p id="cursor-text">View Project</p>
        </div>
      </div>
    </main>
  </body>
</html>

<style is:global lang="scss">
  .transition-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--black);
    transform: scaleY(0);
    transform-origin: bottom;
    z-index: 99999;
    pointer-events: none;
  }

  @keyframes wipeUp {
    from {
      transform: scaleY(0);
    }
    to {
      transform: scaleY(1);
    }
  }

  @keyframes wipeDown {
    from {
      transform: scaleY(1);
    }
    to {
      transform: scaleY(0);
    }
  }

  .transition-overlay.wipe-up {
    transform-origin: bottom;
    animation: wipeUp .6s cubic-bezier(0.85, 0, 0.15, 1) forwards;
  }

  .transition-overlay.wipe-down {
    transform-origin: top;
    animation: wipeDown 1.6s cubic-bezier(0.85, 0, 0.15, 1) forwards;
  }

  // ::view-transition-old(root),
  // ::view-transition-new(root) {
  //   animation: none;
  //   mix-blend-mode: normal;
  // }

  // ::view-transition-old(root) {
  //   z-index: 1;
  // }

  // ::view-transition-new(root) {
  //   z-index: 2;
  // }

  body.nav-open {
    overflow: hidden; /* Prevent scrolling of the body when nav is open */
  }
  html.lenis,
  html.lenis body {
    height: auto;
  }

  .lenis.lenis-smooth {
    scroll-behavior: auto !important;
  }

  .lenis.lenis-smooth [data-lenis-prevent] {
    overscroll-behavior: contain;
  }

  .lenis.lenis-stopped {
    overflow: hidden;
  }

  .lenis.lenis-smooth iframe {
    pointer-events: none;
  }
  .cursor-follower {
    position: fixed;
    top: 0;
    left: 0;
    pointer-events: none;
    z-index: 9999;
    contain: layout style size;
    display: flex;
    opacity: 0;
    /* transform: scale(0); */
    /* transform-origin: 0% 0%; */
    /* mix-blend-mode: difference; */
    /* transform: translate(-50%, -50%) scale(0); */

    & .cursor-inner {
      position: absolute;
      width: 150px;
      height: 150px;
      top: -75px;
      left: -75px;
      transform: scale(0);
      background-color: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      /* mix-blend-mode: difference; */
      border: 2px solid var(--white);
      border-radius: 50%;
      color: var(--white);
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    & p {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: block;
      height: 100%;
      width: 100%;
      display: grid;
      place-items: center;
    }
  }

  #gradient-canvas {
    width: 100%;
    height: 100%;
    --gradient-color-1: #ba00a7;
    --gradient-color-2: #155e89;
    --gradient-color-3: #9aeadd;
    --gradient-color-4: #00000050;
  }

  .link {
    position: relative;
    color: var(--white);
    text-decoration: none;
    display: grid;
    place-items: center;
    text-shadow: 0px 0px 2.3px #efeded;
    overflow: hidden;
    p {
      padding-bottom: 5px;
      transition: all 0.4s cubic-bezier(0.33, 1, 0.68, 1);
      opacity: 1;
    }
  }
  .link:after {
    padding-bottom: 5px;
    content: attr(data-content);
    z-index: 10;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    color: var(--white);
    font-size: 16px;
    line-height: 135%;
    letter-spacing: -0.03rem;
    transform: translateY(100%);
    transition: all 0.9s cubic-bezier(0.33, 1, 0.68, 1);
    font-family: "n27-regular";
    transform-origin: center;
    opacity: 0;
  }
  .link:hover {
    &:after {
      opacity: 1;
      transform: translateY(0%);
      transition: all 0.3s cubic-bezier(0.33, 1, 0.68, 1);
    }
    & p {
      transform: translateY(-100%);
      transition: all 0.4s cubic-bezier(0.33, 1, 0.68, 1);
      opacity: 0;
    }
    &:before {
      transition-delay: 0.3s;
      transition: all 0.4s cubic-bezier(0.33, 1, 0.68, 1);
    }
  }
  .link:before {
    text-shadow: 0px 0px 2.3px #efeded;
    content: "";
    position: absolute;
    bottom: 0px;
    left: 0;
    width: 100%;
    scale: 0;
    transition: all 0.4s cubic-bezier(0.33, 1, 0.68, 1);
    transition-delay: 0.1s;
    transform-origin: left;
    border-bottom: 1px solid var(--white);
  }

  .link:hover:before {
    scale: 1;
  }

  .corner {
    z-index: 10;
    position: absolute;
    aspect-ratio: 1/1;
    width: 50px;
    height: auto;
  }
  .corner-top-left {
    top: -1px;
    left: -1px;
  }
  .corner-top-right {
    top: -1px;
    right: -1px;
    transform: rotate(90deg);
  }
  .corner-bottom-left {
    transform: rotate(-90deg);
    bottom: -1px;
    left: -1px;
  }
  .corner-bottom-right {
    transform: rotate(-180deg);
    bottom: -1px;
    right: -1px;
  }

  #cursor-text {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.3s ease;
  }

  #cursor-text svg {
    position: absolute;
    width: 20px;
    height: 17px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    transition: transform 0.3s ease;
  }

  #cursor-text.rotate-svg svg {
    transform: translate(-50%, -50%) rotate(180deg);
  }

  @media (max-width: 576px) {
    .corner {
      width: 20px;
    }
    .link:after {
      display: none;
    }
    .link {
      display: inline-block;
    }
  }
</style>

<!-- <script src="../components/utils/cursor.js"></script> -->

<script>
  import Cursor from "../components/utils/cursor";
  import Lenis from "lenis";

  // let lenis;

  // if (window.innerWidth > 992) {
  //   if (!navigator.userAgent.includes("Macintosh")) {
  //     lenis = new Lenis({
  //       lerp: 0.15,
  //       wheelMultiplier: 1,
  //       smoothWheel: true,
  //     });
  //   }
  //   new Cursor(document.querySelector(".cursor-follower"));
  // }

  // function raf(time) {
  //   lenis.raf(time);
  //   requestAnimationFrame(raf);
  // }

  // requestAnimationFrame(raf);

  // lenis.on("scroll", (e) => {
  //   // Handle scroll events if needed
  // });

  // page transitions
  // let isTransitioning = false;

  document.addEventListener("astro:before-preparation", () => {
    // if (!isTransitioning) {
    // isTransitioning = true;
    const overlay = document.getElementById("transition-overlay");
    overlay.classList.remove("wipe-down");
    overlay.classList.add("wipe-up");
    // }
  });

  document.addEventListener("astro:after-swap", () => {
    const overlay = document.getElementById("transition-overlay");
    overlay.classList.remove("wipe-up");
    overlay.classList.add("wipe-down");
  });

  document.addEventListener("astro:page-load", () => {
    // isTransitioning = false;
    // const overlay = document.getElementById("transition-overlay");
    // overlay.classList.remove("wipe-down");

    let lenis;

    if (window.innerWidth > 992) {
      if (!navigator.userAgent.includes("Macintosh")) {
        lenis = new Lenis({
          lerp: 0.15,
          wheelMultiplier: 1,
          smoothWheel: true,
        });
      }
      new Cursor(document.querySelector(".cursor-follower"));

      if (lenis) {
        function raf(time) {
          lenis.raf(time);
          requestAnimationFrame(raf);
        }

        requestAnimationFrame(raf);
      }
    }
  });
</script>
