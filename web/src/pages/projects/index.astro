---
import { Image } from "astro:assets";
import Layout from "../../layouts/Layout.astro";
import { getProjectsInOrder, getSiteSettings } from "../../sanity/api";
import CornerTopLeft from "../../components/cornerPieces/cornerTopLeft.astro";
import CornerTopRight from "../../components/cornerPieces/cornerTopRight.astro";
import CornerBottomLeft from "../../components/cornerPieces/cornerBottomLeft.astro";
import CornerBottomRight from "../../components/cornerPieces/cornerBottomRight.astro";
import Footer from "../../components/footer.astro";
import PageTransition from "../../components/pageTransition.astro";

const allProjectData = await getProjectsInOrder();
const settingsData = await getSiteSettings();

const data = allProjectData.projects;
---

<Layout
  title="Projects | WOE Studio"
  data={settingsData}
  description="Explore the Projects page of WOE (What On Earth). Discover our portfolio showcasing select projects from captivating commercials to compelling documentaries, see how our unique approach transforms ideas into impactful visuals."
>
  <PageTransition />
  <div class="project-grid__container">
    <div class="project-entries-container">
      {
        data.map((data, i) => {
          const className =
            i % 5 === 0
              ? "project-entry__double-column"
              : "project-entry__wrapper";
          return (
            <a
              class={`project-entry ${className}`}
              style={{ color: "white" }}
              href={`/projects/${data.slug}`}
            >
              <video
                class="project-video-media hover-area"
                data-hover-text="View project"
                preload="metadata"
                loop="true"
                muted="true"
                playsinline
              >
                <source
                  src={data.previewUrl}
                  type="video/mp4"
                  media="(min-width: 992px)"
                />
                {/* <source
                src={data.previewUrl}
                type="video/mp4"
                media="(min-width: 992px)"
              /> */}
                <source
                  src={
                    data.previewUrlMobile
                      ? data.previewUrlMobile
                      : data.previewUrl
                  }
                  type="video/mp4"
                />
                Your browser does not support the video tag.
              </video>
              <Image
                src={data.thumbnail}
                alt=""
                width={i % 5 === 0 ? 410 : 510}
                height={i % 5 === 0 ? 234 : 297}
                quality="90"
                class="project-image-media__mobile"
              />
              <div class="project-text">
                <span class="project-titleset">
                  {data.clientArray !== null && <p>{data.clientArray[0]}</p>}
                  <p>{data.title}</p>
                </span>
                <span class="project-titleset titleset-services">
                  {/* <p>{data.creditsArray ? data.creditsArray[0] : null}</p> */}
                  <p>{data.servicesArray ? data.servicesArray[0] : null}</p>
                </span>
              </div>
            </a>
          );
        })
      }
    </div>
    <CornerTopLeft />
    <CornerTopRight />
    <CornerBottomLeft />
    <CornerBottomRight />
  </div>
  <Footer data={settingsData} />
</Layout>

<script>
  const projectEntries = document.querySelectorAll(".project-entry");
  const videos = document.querySelectorAll(".project-video-media");

  videos.forEach((video) => {
    video.addEventListener("mouseenter", () => {
      video.play();
    });
    video.addEventListener("mouseleave", () => {
      video.pause();
    });
  });
  // projectEntries.forEach((entry) => {
  //   entry.addEventListener("mouseenter", () => {
  //     projectEntries.forEach((otherEntry) => {
  //       if (otherEntry !== entry) {
  //         otherEntry.style.opacity = "0.6";
  //       }
  //     });
  //   });

  //   entry.addEventListener("mouseleave", () => {
  //     projectEntries.forEach((otherEntry) => {
  //       otherEntry.style.opacity = "1";
  //     });
  //   });
  // });
</script>

<style lang="scss">
  .project-entries-container {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
  }
  /* 
  .project-entry {
    transition: all 0.23s ease;
  } */

  /* .project-entries-container:hover .project-entry:not(:hover) {
      opacity: 0.8;
  } */
  .project-grid__container {
    position: relative;
    display: flex;
    flex-wrap: wrap;
    width: calc(100% - 2rem);
    margin: 1rem auto;
    margin-bottom: 11rem;
  }

  .project-entry__wrapper {
    border-radius: 20px;
    overflow: hidden;
    flex: 1;
    box-sizing: border-box;
    flex-basis: 33.1%;
    height: 50vh;
    transition: 0.8s cubic-bezier(0.77, 0, 0.175, 1);
    position: relative;
  }

  .project-entry__double-column {
    height: 70vh;
    flex: 1 1 100%;
    border-radius: 20px;
    overflow: hidden;
    position: relative;
  }

  .project-entry__wrapper:hover {
    transition: 0.8s cubic-bezier(0.77, 0, 0.175, 1);
    min-width: none;
    flex-grow: 500;
  }

  .project-video-media {
    margin: 0 auto;
    width: 100%;
    height: 100%;
    object-fit: cover;
    cursor: none;
  }
  .project-text {
    position: absolute;
    bottom: 1.5vw;
    left: 1.5vw;
  }
  .project-titleset {
    display: block;
    color: rgba(var(--rgb-white), 1);
    /* padding-bottom: 0.5rem; */
  }
  .titleset-services {
    padding-top: 0.5rem;
    color: rgba(var(--rgb-white), 0.5);
  }

  @media (max-width: 1280px) {
    .project-entries-container {
      gap: 0.5rem;
    }
    .project-grid__container {
      gap: 0.5rem;
      width: calc(100% - 1rem);
      margin-top: 0.5rem;
    }
  }

  .project-image-media__mobile {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: none;
  }
  @media (max-width: 992px) {
    .project-image-media__mobile {
      display: block;
    }
    .project-video-media {
      display: none;
    }
    .project-entries-container {
      gap: 0.25rem;
    }
    .project-entry__wrapper {
      height: 70vw;
      border-radius: 6px;
    }
    .project-entry__double-column {
      border-radius: 6px;
      height: auto;
    }
  }
</style>
